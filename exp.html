<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker with Local Storage</title>
</head>

<body>

    <form action="#" onsubmit="addExpense(event)">
        <label for="">Choose Expense Amount : </label>
        <input type="number" name="" id="expamount">
        <label for="">Choose Description : </label>
        <input type="text" name="" id="expdesc">
        <label for="">Choose Category : </label>
        <select name="" id="expcategory">
            <option value="Fuel">Fuel</option>
            <option value="Food">Food</option>
            <option value="Electricity">Electricity</option>
            <option value="Movie">Movie</option>
        </select>
        <button id="addexp" type="submit"> Add Expense</button>
    </form>
    <ul id="explist"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>

    <script>
        const explist = document.getElementById('explist')
        const expamount = document.getElementById('expamount')
        const expdesc = document.getElementById('expdesc')
        const expcategory = document.getElementById('expcategory')
        const expbtn = document.getElementById('addexp')
        let id;

        const backendurl = 'http://localhost:3000/exp'

        document.addEventListener('DOMContentLoaded', () => {
            axios.get(`${backendurl}/getexpense`)
                .then(res => {
                    let d = res.data
                    for (let i = 0; i < d.length; i++) {
                        createChild(d[i].id, d[i])
                    }
                })
                .catch(err => {
                    alert('something went wrong')
                })

        })

        function editFunction(e) {
            let elem = e.target.parentElement
            let exp = elem.getAttribute('id')
            expamount.value = exp.amount
            expdesc.value = exp.description
            expcategory.value = exp.category

            axios.get(`${backendurl}/getaexpense/${exp}`)
                .then(res => {
                    let d = res.data
                    expamount.value = d.amount
                    expdesc.value = d.description
                    expcategory.value = d.category
                    expbtn.innerHTML = 'Update Expense'
                    id = d.id

                })
                .catch(err => {
                    alert('something went wrong')
                })





            // localStorage.removeItem(elem.getAttribute('id'))
            // explist.removeChild(elem)
        }

        function delFunction(e) {
            let elem = e.target.parentElement
            let exp = elem.getAttribute('id')
            axios.delete(`${backendurl}/deleteexpense/${exp}`)
                .then(res => {
                    window.location.reload()
                })
                .catch(err => {
                    alert('something went wrong--------')
                })

        }

        function createChild(k, obj) {
            const li = document.createElement('li')
            li.setAttribute('id', k)
            li.appendChild(document.createTextNode(`${obj.amount} - ${obj.description} - ${obj.category}`))
            let delbtn = document.createElement('button')
            let editbtn = document.createElement('button')
            editbtn.setAttribute('onclick', 'editFunction(event)')
            delbtn.setAttribute('onclick', 'delFunction(event)')
            delbtn.appendChild(document.createTextNode('Delete'))
            editbtn.appendChild(document.createTextNode('Edit'))
            li.appendChild(editbtn)
            li.appendChild(delbtn)
            explist.appendChild(li)
            expamount.value = ''
            expdesc.value = ''
            expcategory.value = ''

        }

        function addExpense(e) {
            e.preventDefault()
            if (expbtn.innerHTML == 'Update Expense') {
                axios.put(`${backendurl}/updatexpense/${id}`, {
                    amount: expamount.value,
                    description: expdesc.value,
                    category: expcategory.value
                    // Date: document.getElementById('dateid').value,
                    // Time: document.getElementById('timeid').value
                }).then(res => {
                    // alert('updated successfully')
                    window.location.reload()
                }).catch(err => {
                    alert('something went wrong')
                })
            } else {

                // let key = expamount.value + expdesc.value + expcategory.value
                let exp = {
                    amount: expamount.value,
                    description: expdesc.value,
                    category: expcategory.value
                }

                axios.post(`${backendurl}/addexpense`, exp)
                    .then(res => {
                        window.location.reload()
                        // alert('submitted successfully')
                    }).catch(err => {
                        alert('something went wrong')
                    })
                // localStorage.setItem(key, JSON.stringify(exp))
                // createChild(key, exp)

            }
        }
    </script>

</body>

</html>