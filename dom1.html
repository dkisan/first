<!-- https://embed.plnkr.co/plunk/8ujYdL1BxZftGoS4Cf14 -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dom Manipulation 1</title>
</head>

<body>
    <form action="#" onsubmit="submitForm(event)">
        <form id="my-form">
            <h1>Add User</h1>
            <div class="msg"></div>
            <div>
                <label for="name">Name:</label>
                <input type="text" id="name">
            </div>
            <div>
                <label for="email">Email:</label>
                <input type="text" id="email">
            </div>
            <input class="btn" type="submit" value="Submit">
        </form>

        <ul id="users"></ul>

        <ul class="items">
            <!-- <li class="item">Item 1</li>
            <li class="item">Item 2</li>
            <li class="item">Item 3</li> -->
        </ul>
    </form>

    <script>
        const ul = document.querySelector('.items')
        const name = document.querySelector('#name')
        const email = document.querySelector('#email')

        Object.keys(localStorage).forEach(element => {
            let a = JSON.parse(localStorage.getItem(element))
            const li = document.createElement('li')
                const button = document.createElement('button')
                button.appendChild(document.createTextNode('delete'))
                button.setAttribute('onClick', 'deleteFunction(event)')
                li.appendChild(document.createTextNode(`Name - ${a.Name} & Email - ${a.Email}`))
                li.appendChild(button)
                ul.appendChild(li)
        });

        

        function deleteFunction(e) {
            let a = e.target.parentElement.textContent.split(' ')[2]
            ul.removeChild(e.target.parentElement)
            localStorage.removeItem(a)
        }

        function submitForm(e) {
            e.preventDefault()
            if (name.value === '' || email.value === '') {
                alert('fill all the fields')
            } else {
                const li = document.createElement('li')
                const button = document.createElement('button')
                button.appendChild(document.createTextNode('delete'))
                button.setAttribute('onClick', 'deleteFunction(event)')
                li.appendChild(document.createTextNode(`Name - ${name.value} & Email - ${email.value}`))
                li.appendChild(button)
                ul.appendChild(li)
                // if (localStorage.getItem('user')) {
                //     const user = JSON.parse(localStorage.getItem('user'))
                //     let bool = true
                //     Array.from(user.data).forEach(u => {
                //         if (u.name == name.value) {
                //             bool = false
                //         }
                //     })
                //     if (bool) {

                //         user.data.push({
                //             'name': name.value,
                //             'email': email.value,
                //         })
                //         localStorage.setItem('user', JSON.stringify(user))
                //     } else {
                //         alert('user already present')
                //     }

                // } else {

                //     const user = {
                //         data: []
                //     }
                //     user.data.push({
                //         'name': name.value,
                //         'email': email.value,
                //     })

                //     localStorage.setItem('user', JSON.stringify(user))
                // }

                if (!localStorage.getItem(name.value)) {
                    localStorage.setItem(name.value, JSON.stringify({ Name: name.value, Email: email.value }))
                } else {
                    alert('user already present')

                }
                name.value = ''
                email.value = ''

            }
        }
        // ul.firstElementChild.innerHTML = 'Hello'
        // ul.firstElementChild.style.color = 'green'
        // ul.children[1].style.color = 'yellow'
    </script>

</body>

</html>